(function($){$(function(){var options=$.extend({fieldName:"#s",maxRows:-1,minLength:3,hintBox:'ul.search-hint',maxRowsByCat:5},SearchAutocomplete);options.fieldName=$("<div />").html(options.fieldName).text();$.widget("custom.catcomplete",$.ui.autocomplete,{_create:function(){this._super();this.widget().menu("option","items","> :not(.search-hint-header)");this.widget().menu().addClass('search-hint');},_renderMenu:function(ul,items){var that=this,currentCategory="",i=1;$.each(items,function(index,item){var li;if(item.category!=currentCategory){ul.append("<hr class='status-divider'>");ul.append("<li class='search-hint-header'>"+item.category+"</li>");currentCategory=item.category;i=1;}
if(i>options.maxRowsByCat){return true;}
li=that._renderItemData(ul,item);if(item.category){li.attr("aria-label",item.category+" : "+item.label);}
i++;});},_renderItem:function(ul,item){return $("<li>").addClass("search-hint-item").append("<div class='search-hint-title'>"+item.label+"</div>").append('<div class="search-hint-descr">'+item.excerpt+'</div>').appendTo(ul);}});$(options.fieldName).catcomplete({delay:options.delay,minLength:options.minLength,autoFocus:(options.autoFocus==='true'),source:function(request,response){$.ajax({url:options.ajaxurl,dataType:"json",data:{action:"autocompleteCallback",term:this.term,postType:$(options.fieldName).data('post-type')},success:function(data){data=$.map(data.results,function(item,index){return{category:item.category,value:item.title,excerpt:item.excerpt,url:item.url};});data.sort(function(a,b){return(a.category>b.category)?1:((b.category>a.category)?-1:0);});response(data);},error:function(jqXHR,textStatus,errorThrown){console.log(jqXHR,textStatus,errorThrown);}});},search:function(event,ui){$(event.currentTarget).addClass("sa_searching");},focus:function(event,ui){event.preventDefault();},open:function(event){var acData=$(this).data('customCatcomplete');$(options.hintBox).find(".search-hint-title, .search-hint-descr").each(function(){var $self=$(this),keywords=$.trim(acData.term).split(" ").join("|");$self.html($self.text().replace(new RegExp("("+keywords+")","gi"),'<strong>$1</strong>'));});$(event.target).removeClass("sa_searching");$(options.hintBox).find('hr.status-divider').first().remove();$('.ui-helper-hidden-accessible').hide();var currentMarginTop=parseInt($(options.hintBox).css('margin-top'));$(options.hintBox).css({'margin-top':currentMarginTop+7+'px'});},select:function(e,ui){location.href=ui.item.url;}});});})(jQuery);