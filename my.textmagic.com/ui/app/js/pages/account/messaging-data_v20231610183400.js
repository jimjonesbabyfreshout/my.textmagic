var MessagingData=function(){this.init();};MessagingData.prototype.init=function(){this.peopleSelectBox=$('select#peopleMessagingData');this.deleteBtn=$('button[data-entity]');this.pwdInput=$('input[type=password]');this.confirmLnk=$('a.confirm-window');this.exportLnk=$('[data-widget="export"]');this.topAlert=$('[data-widget="top-alert"]');this.btnEditDataMessagesLifetime=$('#edit-data-messages-lifetime');this.selDataMessagesLifetime=$('#data-messages-lifetimes');this.spanDataMessagesLifetime=$('#data-messages-lifetime-label');this.divContDataMessagesLifetime=this.selDataMessagesLifetime.closest('div');this.maxExport=500000;};MessagingData.prototype.deleteBtnClickHandler=function(options){var that=this;var deleteBtn=$('button[data-entity='+options.entity+']');var pwdInput=deleteBtn.closest('.modal-dialog').find('input[type=password]');$.ajax({dataType:'JSON',type:'POST',url:options.url,data:{entity:options.entity,pwd:options.pwd},beforeSend:function(){deleteBtn.spin('enable','Deleting...');},success:function(xhr){if(xhr.success){$('#'+options.entity+'ConfirmModal').modal('hide');var entityName;switch(options.entity){case 'contacts':entityName='Contacts';break;case 'messages':entityName='Messages';break;default:entityName=$.camelCase(options.entity);}
app.track('Deleted All '+entityName,'Back Office',{amount:options.amount});window.location.href=options.redirectTo;}else{parseAllErrors(xhr.message);}
deleteBtn.spin('disable');},error:function(xhr){deleteBtn.spin('disable');}});};MessagingData.prototype.btnEditDataMessagesLifetimeClickHandler=function(){this.btnEditDataMessagesLifetime.addClass('hidden');this.spanDataMessagesLifetime.addClass('hidden');this.divContDataMessagesLifetime.removeClass('hidden');};MessagingData.prototype.selDataMessagesLifetimeChangeHandler=function(){var that=this,value=this.selDataMessagesLifetime.val(),label=this.selDataMessagesLifetime.find('option:selected').text();$.ajax({url:'/online/account/my-data/update/data-messages-lifetime',method:'POST',dataType:'JSON',data:{lifetime:value},beforeSend:function(){that.divContDataMessagesLifetime.spin('enable');},success:function(xhr){that.hideSelDataMessagesLifetime();that.spanDataMessagesLifetime.text(label);that.topAlert.successBlock(xhr.message);},error:function(xhr){console.warn(xhr);},complete:function(xhr){that.divContDataMessagesLifetime.spin('disable');}});};MessagingData.prototype.hideSelDataMessagesLifetime=function(){this.btnEditDataMessagesLifetime.removeClass('hidden');this.divContDataMessagesLifetime.addClass('hidden');this.spanDataMessagesLifetime.removeClass('hidden');};MessagingData.prototype.confirmExport=function(params){var randId=Math.floor(Math.random()*1000000);var defaultParameters={title:'Send the download link to an email',message:'Export of data can take some time. Please enter email address, and we will send a download link as soon as possible.',url:'javascript:void(0);'};var params=$.extend({},defaultParameters,params);var markup=['<div id="exportModal_'+randId+'" class="modal modal-sm fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="false">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-body text-center">','<h2>'+params.title+'</h2>','<p>'+params.message+'</p>','<div class="form-group">','<input class="form-control" type="text" name="export_email" value="'+app.u_email+'"/>','</div>','<p class="confirmModalButtons">','<button class="btn btn-default" type="button" data-dismiss="modal" data-crud="cancel">Cancel</button>','<button class="btn btn-success btn-solid disabled" type="button" data-crud="send-export">Send</button>','</p>','</div>','</div>','</div>','</div>'].join('');$(markup).hide().appendTo('body').modal('show');var modalWindow=$('#exportModal_'+randId);var exportBtn=$('button[data-crud="send-export"]');var cancelBtn=$('button[data-crud="cancel"]');exportBtn.btn('disable');modalWindow.find('input[name="export_email"]').focus();modalWindow.find('button[data-crud="send-export"]').on('click',function(){var email=$('input[name="export_email"]').val();var csrfToken=$('meta[name="csrf-token"]').attr('content');$(this).spin('enable');cancelBtn.btn('disable');window.location.href=params.url+'?email='+encodeURIComponent(email)+'&_csrf_token='+encodeURIComponent(csrfToken);});modalWindow.find('input[name="export_email"]').on('input change click keyup blur focus',function(){var email=$(this).val();if($.simpleEmailValidate(email)){exportBtn.btn('enable');}else{exportBtn.btn('disable');}});};MessagingData.prototype.exportLnkClickHandler=function(options){this.confirmExport(options);};