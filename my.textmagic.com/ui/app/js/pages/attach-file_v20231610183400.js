$(document).ready(function(){var fileId;var fileLink;var attachCanceled;var $newMsgText=$('#newMsgText');if(typeof jQuery.fn.ajaxForm==='function'){$("#attachFileForm").ajaxForm({dataType:'json',beforeSubmit:function(){attachCanceled=false;$("#progressButton").addClass('disabled').val('Attaching...');},success:function(xhr){$("#progressButton").removeClass('disabled').val('Attach file');if(xhr.success==true&&!attachCanceled){$("#attachFileModal").modal("hide");var result=$("#attachFileModal2");result.find("[data-file=name]").text(xhr.data.name);result.find("[data-file=link]").html(xhr.data.link);result.find("[data-file=tag]").html(xhr.data.tag);result.find("[data-file=characters]").text(xhr.data.charactersTaken+' characters');result.find("[data-file=size]").text(Math.ceil((parseInt(xhr.data.size)/1024)*2)/2+' kb');result.find("[data-file=preview]").html(xhr.data.resource);fileId=xhr.data.id;fileLink=xhr.data.tag;result.modal("show");}else{$('#upload-alert').warningBlock(xhr.message.alert||'File uploading was cancelled.');}},error:function(response){if(response.status===413){$('#upload-alert').warningBlock("The selected file size exceeds the allowed limit. File size can be up to 10MB.");}else{$('#upload-alert').warningBlock("Server unexpectedly closed the connection. Possible reasons are: the file is too large (>10 MB) or server is temporary down.");}
$("#progressButton").removeClass('disabled').val('Attach file');}});}else{}
$(document.body).on('click',"#attachButton",function(e){e.preventDefault();$.ajax({url:'/online/messages/file/update',type:'post',dataType:'json',data:{id:fileId},success:function(xhr){if(xhr.success){if(typeof(wsChatDefined)==='undefined'||!wsChatDefined){$newMsgText.textAtCaret(fileLink).change().blur();}else{$newMsgText.val($newMsgText.val()+' '+fileLink).change();}}
$newMsgText.trigger('input.count');}});$("#attachFileModal2").modal("hide");});var $attachFileModal=$('#attachFileModal');$attachFileModal.on({'show.bs.modal':function(){$('#attachFileChoose').val('');$('#upload-alert').html('').hide();}});$attachFileModal.on({'hide.bs.modal':function(){attachCanceled=true;$("#progressButton").removeClass('disabled').val('Attach file');}});});