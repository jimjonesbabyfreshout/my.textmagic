;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;(function(container){var entity,thisApiHandler,defaultApiHandler,apiCalls;var nop=function(){};var nopHandler={done:nop,fail:nop,always:nop};var exports={nop:nopHandler,Messages:{preview:{done:function(res,opt){console.log(res);},fail:function(xhr){},always:function(){}},}};exports.init=function(){entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');thisApiHandler=container.get('Textmagic::MmsPreviewBundle::Api::Handlers');apiCalls=container.get('Textmagic::CoreBundle::Api::Calls').setHandler(thisApiHandler);};container.register('Textmagic::MmsPreviewBundle::Api::Handlers',exports);})(global.AHServiceContainer);(function(container){var entity,vue,message;var exports={init:function(){vue=container.get('Textmagic::FrameworkBundle::VueComponent');entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');},run:function(options){if(options){message=options.message;}
if(options){var app=container.get('Textmagic::MmsPreviewBundle::Components::App');message=options.props.message;var vm=vue.renderAndMount(app,options.props,{},options.el);return vm;}else{global.Vue.component('emoji',global.EmojiMart.Emoji);vue.register(container.match('^Textmagic::MmsPreviewBundle::Components::'),'all');}},getMessage:function(){return message;}};container.register('Textmagic::MmsPreviewBundle::App',exports);})(global.AHServiceContainer);(function(container){var entity,apiCalls,apiHandler,external;var exports=[{template:'#message-preview-modal',data:function(){return{state:entity('MessagePreview')};},methods:{},computed:{}}];exports.init=function(){entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');external=container.get('Textmagic::CoreBundle::Component::External');};container.register('Textmagic::MmsPreviewBundle::Components::MessagePreviewModal',exports);})(global.AHServiceContainer);(function(container){function isUrlCached(url){var image=document.createElement('img');image.src=url;return image.complete;}
var exports=[{template:'#img-transition',props:{isVideo:{type:Boolean,default:false},alt:{type:String,default:''},src:{type:String,default:''}},computed:{cached:function(){return isUrlCached(this.src);}},methods:{imageOnLoad:function(){this.loaded=true;}},data:function(){return{loaded:false}}}];exports.init=function(){};container.register('Textmagic::MmsPreviewBundle::Components::ImgTransition',exports);})(global.AHServiceContainer);(function(container){var entity,dateFormat,external,linkify;function downloadURI(uri,name){var link=document.createElement("a");link.download=name;link.href=uri;document.body.appendChild(link);link.click();document.body.removeChild(link);delete link;}
var exports=[{template:'#message-body',props:{isSingle:{type:Boolean,default:false},message:{type:Object,default:{}},messagesSearchQuery:{type:Boolean,default:false},currentAudioMessageId:{type:String,default:false},selected:{type:Boolean,default:false},imageOnLoad:{type:Function,default:function(){}},extraClasses:{type:Object,default:function(){return{video:''}}}},methods:{imageStyle:function(item){function linearSizeReduce(x,y,module){return Math.round(x*module/y);}
var h=linearSizeReduce(item.height,item.width,400);var w=linearSizeReduce(item.width,item.width,400);var needRresize=item.height>400||item.width>400;var style=' height:'+(needRresize?h:item.height)+'px;'
style+=' width:'+(needRresize?w:item.width)+'px;';return style;},isCallMessage:function(){return['co','ci','cim'].includes(this.message.direction);},isMediaMessage:function(){return this.message.text&&this.message.text.indexOf('<media ')>=0;},isAudioMessage:function(){return this.message.text&&this.message.text.indexOf('<audio src=')>=0;},isSimpleMessage:function(){return!(this.isCallMessage()||this.isMediaMessage()||this.isAudioMessage());},getTextPart:function(){var isMediaMessage=this.isMediaMessage();var isAudioMessage=this.isAudioMessage();if(!(isMediaMessage||isAudioMessage)){return this.message.text;}
var tag=isAudioMessage?'<audio src=':'<media ';var pos=this.message.text.indexOf(tag);return this.message.text.substring(0,pos);},toggleAudioClick:function(messageId){var players=document.getElementsByTagName('audio');players=Array.prototype.slice.call(players);players.forEach((function(elem){if(elem.dataset.hasOwnProperty('message')&&elem.dataset.message==messageId){if(elem.paused){this.isPlaying=true;elem.play();return;}else{this.isPlaying=false;var e=new CustomEvent('ended');elem.dispatchEvent(e);}}
elem.pause();elem.currentTime=0;}).bind(this));},replaceAudioMessageTextAsHtml:function(text){return text.replace('<audio','<a ').replace(' src=','target="_blank" href=').replace('<\/audio>','<\/a>');},getAudioSource:function(){if(!this.isAudioMessage()){return '';}
var matches=this.message.text.match(/<audio src=['|"](.+)['|"]/);return(typeof(matches[1])==='undefined'?'':matches[1]);},formatMessageTextAsHtml:function(){var text=this.getTextPart();text=text.replace(/[&"<>]/g,function(c){return{'&':"&amp;",'"':"&quot;",'<':"&lt;",'>':"&gt;"}[c];});if(!this.isAudioMessage()){text=linkify(text);}else{return this.replaceAudioMessageTextAsHtml(this.message.text);}
if(typeof this.messagesSearchQuery=='string'&&this.messagesSearchQuery.length>0){text=this.highlight(text,this.messagesSearchQuery);}
text=text.split("\n").join('<br\/>');return external.replaceEmojis(text);},highlight:function(value,query){if(!query){return value;}
var hl='<span class="chat-highlight">$&</span>';return value.split(">").map(function(part){var bytes=part.split('<');bytes[0]=bytes[0].replace(new RegExp(RegExp.escape(query),'gi'),hl);return bytes.join('<');}).join('>');},showMediaPreview:function(media){if(this.selected){return;}
var message=container.get('Textmagic::MmsPreviewBundle::App').getMessage();if(!message){entity('MmsPreview').setMedia(media);entity('MmsPreview').showModal();}else{downloadURI(media.resourceDownloadUrl,media.name);}}},computed:{getCallDataFromMessage:function(){var callTime=this.message.text.match(/^.*?\([^\d]*(\d+)[^\d]*\).*$/);var callTimeFormatted='0:00:00';if(callTime&&callTime[1]){callTimeFormatted='('+dateFormat.timeFormatFromSeconds(callTime[1])+')';}
var direction,icon,textClass;if(this.message.direction=='co'){direction='Outbound';icon='tmi30-handset-arrow';textClass='text-primary';}else{if(parseInt(callTime[1])==0){direction='Missed';icon='tmi30-handset-cancel';textClass='text-danger';}else{direction='Inbound';icon='tmi30-handset-arrow-back';textClass='text-success';}}
return{direction:direction,icon:icon,textClass:textClass,callTimeFormatted:callTimeFormatted};},getMediaInfoFromMessage:function(){return container.get('Textmagic::CoreBundle::Services::MMS').getMediaInfoFromMessage(this.message.text);}},data:function(){return{vshow:false,isPlaying:false}},mounted:function(){this.vshow=true;}}];exports.init=function(){entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');external=container.get('Textmagic::CoreBundle::Component::External');dateFormat=container.get('Textmagic::CoreBundle::Utils::Date');linkify=container.get('Textmagic::CoreBundle::Utils::Linkify').linkify;};container.register('Textmagic::MmsPreviewBundle::Components::MessageBody',exports);})(global.AHServiceContainer);(function(container){var entity,apiCalls,apiHandler,external,textSetter;var exports=[{template:'#mms-preview-modal',data:function(){return{state:entity('MmsPreview')};},methods:{download:function(){},},computed:{downloadUrl:function(){return this.state.getResourceDownloadUrl().replace(new RegExp(/\'/g),'');}}}];exports.setInsertLinkDependency=function(setter){textSetter=setter;};exports.init=function(){entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');external=container.get('Textmagic::CoreBundle::Component::External');};container.register('Textmagic::MmsPreviewBundle::Components::MmsPreviewModal',exports);})(global.AHServiceContainer);(function(container){var external;var exports=[{template:'#emoji-loader',props:{},data:function(){return{}},mounted:function(){external.setEmojiData(this.$refs.textmagicEmojiLoaderSingle.data);},}];exports.init=function(){external=container.get('Textmagic::CoreBundle::Component::External');};container.register('Textmagic::MmsPreviewBundle::Components::EmojiLoader',exports);})(global.AHServiceContainer);(function(container){var entity,apiCalls,apiHandler,external;var exports=[{template:'#message-preview-table',data:function(){return{};},methods:{},computed:{}}];exports.init=function(){entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');external=container.get('Textmagic::CoreBundle::Component::External');};container.register('Textmagic::MmsPreviewBundle::Components::MessagePreviewTable',exports);})(global.AHServiceContainer);(function(container){var entity,external;var exports={template:'#mms-preview-app',props:{message:{type:Object,required:true},currentAudioMessageId:{},extraClasses:{type:Object,default:function(){return{video:''}}}}};exports.init=function(){entity=container.get('Textmagic::FrameworkBundle::Entity').useBundle('Textmagic::MmsPreviewBundle');external=container.get('Textmagic::CoreBundle::Component::External');};container.register('Textmagic::MmsPreviewBundle::Components::App',exports);})(global.AHServiceContainer);(function(container){var entity,external,base,ulilsFile,apiHandler;var exports={init:function(){entity=container.get('Textmagic::FrameworkBundle::Entity');base=container.get('Textmagic::CoreBundle::Repository::BaseModalForm');ulilsFile=container.get('Textmagic::CoreBundle::Utils::File');entity({name:'Textmagic::MmsPreviewBundle::MessagePreview',initState:base.initForm({modalId:'vueMessagePreviewModal',media:{},version:0}),methods:[base,this]});},showModal:function(type){console.log('itsme');this.toggleModal(true,true);}};container.register('Textmagic::MmsPreviewBundle::Repository::MessagePreview',exports);})(global.AHServiceContainer);(function(container){var entity,external,base,ulilsFile,apiHandler;var exports={init:function(){entity=container.get('Textmagic::FrameworkBundle::Entity');base=container.get('Textmagic::CoreBundle::Repository::BaseModalForm');ulilsFile=container.get('Textmagic::CoreBundle::Utils::File');entity({name:'Textmagic::MmsPreviewBundle::MmsPreview',initState:base.initForm({modalId:'vueMmsPreviewModal',media:{},version:0}),methods:[base,this]});},showModal:function(type){this.toggleModal(true,true);},setMedia:function(media){this.set('media',media);this.set('version',this.get('version').raw+1);},getResourceFullUrl:function(){return this.get('media.resourceFullUrl').raw?this.get('media.resourceFullUrl').raw:'';},getResourceDownloadUrl:function(){return this.get('media.resourceDownloadUrl').raw?this.get('media.resourceDownloadUrl').raw:'';},getFileExt:function(){return this.get('media.fileExt').raw;},getFileSizeLabel:function(){return this.get('media.fileSizeLabel').raw;},isImage:function(){return this.get('media.isImage').raw;},isVideo:function(){return this.get('media.isVideo').raw;}};container.register('Textmagic::MmsPreviewBundle::Repository::MmsPreview',exports);})(global.AHServiceContainer);